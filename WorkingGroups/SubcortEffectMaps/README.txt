This matlab code is meant to be used after running meta- (or single study) analysis scripts,
found in ENIGMA-Git/WorkingGroups/EffectSize_GLM on subcortical vertex-wise features generated by the ENIGMA-Shape pipeline. 
It performs searchlight False Discovery Rate correction (see Langers, et al) on subcortical mesh p-values, and maps surviving results.

You will need to make small modifications to run on your system. Example files are included to show what the input for these scripts shoud look like. 
In the example below, it is assumed we are using the example Schizophrenia study. Note that this will not actually work with the attached example 
files, as they are deliberately made incomplete. Note also that the steps below are only needed to be done once to generate FDR-corrected maps for all 
linear models used


In Matlab, go the folder Matlab\matlab_code, and try to run the following commands:
1.	SCZ_prefix{1} = '[your full path]\ Matlab\input_files\ENIGMA_SCHIZO_SHAPE1_meta';
2.	SCZ_prefix{2} = ''
3.	[names_SCZ, factors_SCZ] = read_cov_names_for_csv_stats('Schizo_Meta_basics.csv');
4.	[SCZ_P, SCZ_D, SCZ_BETA] = read_all_csv_stats_meta(SCZ_prefix, names_SCZ, [],factors_SCZ);
4b. 	If using a single study analysis, use instead 
	[SCZ_P, SCZ_D, SCZ_BETA] = read_all_csv_stats_mega(SCZ_prefix, names_SCZ, [],factors_SCZ);

Next, modify the following files to point to the correct location of the “atlas” directory, and the CCBBM executable (3 binary versions included).
Change path styles for unix-based systems.

Adding a path variable may be easiest:
i.	make_beta_maps
ii.	write_P_with_mesh_plain_gen
iii.	get_atlas_coords
iv.	get_atlas_area
v.	write_attribute_with_mesh_gen

To generate regression coefficient maps and summary, run the following: 
all_shape_SL_global_viz(SCZ_P,SCZ_BETA,names_SCZ,0,0,'[your full path]\Matlab\output’);

To generate effect size maps and summary, replace SCZ_BETA with SCZ_D above. 

This will generate several objects in the output folder:

i. 	Matlab figure files with distributions of q-values
ii. 	summary.csv, with a summary of the results for each linear model. 
iii. 	Mesh files with rgb coloring of the maps (in ../output/maps)
iv. 	bitmap images containing snapshots of the maps, useful for paper figures (in ../output/map_images)

For questions, please email:

Boris Gutman, bgutman@gmail.com
Chris Ching, cching47@gmail.com

